# Gosinble å¸¸ç”¨å†…ç½®æ“ä½œæŒ‡å—

## ğŸ¯ æ ¸å¿ƒæ¨¡å— (Core Modules)

### 1. **æ–‡ä»¶ç®¡ç† (File)**
```bash
# åˆ›å»ºç›®å½•
gosinble -m file -a "path=/opt/app state=directory mode=0755"

# åˆ›å»ºæ–‡ä»¶
gosinble -m file -a "path=/etc/app.conf state=file mode=0644"

# åˆ›å»ºè½¯é“¾æ¥
gosinble -m file -a "src=/opt/app/bin path=/usr/local/bin/app state=link"

# åˆ é™¤æ–‡ä»¶/ç›®å½•
gosinble -m file -a "path=/tmp/old state=absent"

# ä¿®æ”¹æƒé™å’Œæ‰€æœ‰è€…
gosinble -m file -a "path=/opt/app mode=0755 owner=app group=app"
```

### 2. **æœåŠ¡ç®¡ç† (Service)**
```bash
# å¯åŠ¨/åœæ­¢æœåŠ¡
gosinble -m service -a "name=nginx state=started"
gosinble -m service -a "name=apache2 state=stopped"

# é‡å¯/é‡è½½æœåŠ¡
gosinble -m service -a "name=nginx state=restarted"
gosinble -m service -a "name=nginx state=reloaded"

# å¼€æœºè‡ªå¯
gosinble -m service -a "name=nginx enabled=true"

# systemd daemon-reload
gosinble -m service -a "name=myapp daemon_reload=true state=restarted"
```

### 3. **åŒ…ç®¡ç† (Package)**
```bash
# å®‰è£…è½¯ä»¶åŒ…
gosinble -m package -a "name=nginx state=present"

# å®‰è£…å¤šä¸ªåŒ…
gosinble -m package -a "name=git,vim,curl state=present"

# å¸è½½è½¯ä»¶åŒ…
gosinble -m package -a "name=apache2 state=absent"

# æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬
gosinble -m package -a "name=docker state=latest update_cache=true"
```

### 4. **ç”¨æˆ·ç®¡ç† (User)**
```bash
# åˆ›å»ºç”¨æˆ·
gosinble -m user -a "name=appuser uid=1001 shell=/bin/bash"

# åˆ›å»ºç³»ç»Ÿç”¨æˆ·
gosinble -m user -a "name=myservice system=true shell=/bin/false"

# æ·»åŠ åˆ°ç»„
gosinble -m user -a "name=john groups=sudo,docker append=true"

# åˆ é™¤ç”¨æˆ·ï¼ˆåŒ…æ‹¬å®¶ç›®å½•ï¼‰
gosinble -m user -a "name=olduser state=absent remove=true"

# è®¾ç½®å¯†ç 
gosinble -m user -a "name=john password=secretpass"
```

### 5. **ç»„ç®¡ç† (Group)**
```bash
# åˆ›å»ºç»„
gosinble -m group -a "name=developers gid=2001"

# åˆ›å»ºç³»ç»Ÿç»„
gosinble -m group -a "name=myservice system=true"

# åˆ é™¤ç»„
gosinble -m group -a "name=oldgroup state=absent"
```

### 6. **å‘½ä»¤æ‰§è¡Œ (Command/Shell)**
```bash
# æ‰§è¡Œå‘½ä»¤
gosinble -m command -a "cmd='ls -la /opt'"

# æ‰§è¡ŒShellå‘½ä»¤ï¼ˆæ”¯æŒç®¡é“ã€é‡å®šå‘ï¼‰
gosinble -m shell -a "cmd='cat /etc/passwd | grep root'"

# å¸¦å·¥ä½œç›®å½•
gosinble -m command -a "cmd=make chdir=/opt/app"

# æ¡ä»¶æ‰§è¡Œ
gosinble -m command -a "cmd='rm -rf /tmp/cache' creates=/tmp/cache"
```

### 7. **æ–‡ä»¶å¤åˆ¶ (Copy)**
```bash
# å¤åˆ¶æ–‡ä»¶åˆ°è¿œç¨‹
gosinble -m copy -a "src=/local/file.txt dest=/remote/file.txt mode=0644"

# å¤‡ä»½åŸæ–‡ä»¶
gosinble -m copy -a "src=app.conf dest=/etc/app.conf backup=true"

# ç›´æ¥å†™å…¥å†…å®¹
gosinble -m copy -a "content='Hello World' dest=/tmp/hello.txt"
```

### 8. **æ¨¡æ¿æ¸²æŸ“ (Template)**
```bash
# æ¸²æŸ“æ¨¡æ¿æ–‡ä»¶
gosinble -m template -a "src=nginx.conf.j2 dest=/etc/nginx/nginx.conf"

# å¸¦å˜é‡æ¸²æŸ“
gosinble -m template -a 'src=app.yml.j2 dest=/opt/app/config.yml vars={"port":8080,"debug":false}'

# å¤‡ä»½åŸæ–‡ä»¶
gosinble -m template -a "src=config.j2 dest=/etc/app.conf backup=true"
```

### 9. **è°ƒè¯•è¾“å‡º (Debug)**
```bash
# è¾“å‡ºæ¶ˆæ¯
gosinble -m debug -a "msg='Current status: OK'"

# è¾“å‡ºå˜é‡
gosinble -m debug -a "var=ansible_facts"
```

### 10. **è¿æ¥æµ‹è¯• (Ping)**
```bash
# æµ‹è¯•è¿æ¥
gosinble -m ping
```

### 11. **ç³»ç»Ÿä¿¡æ¯æ”¶é›† (Setup)**
```bash
# æ”¶é›†ç³»ç»Ÿfacts
gosinble -m setup

# åªæ”¶é›†ç‰¹å®šä¿¡æ¯
gosinble -m setup -a "gather_subset=network"
```

## ğŸ”§ é«˜çº§ä»»åŠ¡åº“ (Advanced Task Library)

### æ–‡ä»¶ä»»åŠ¡ (FileTasks)
```go
tasks := library.NewFileTasks()

// ç¡®ä¿æ–‡ä»¶å­˜åœ¨å¹¶è®¾ç½®å†…å®¹
tasks.EnsureFile("/etc/app.conf", "config content", 0644)

// å¤‡ä»½æ–‡ä»¶
tasks.BackupFile("/etc/important.conf", "/backup/")

// æ¨¡æ¿é…ç½®
tasks.TemplateConfig("nginx.conf.j2", "/etc/nginx/nginx.conf", vars)

// åŒæ­¥ç›®å½•
tasks.SyncDirectory("/source/", "/dest/")

// æ¸…ç†æ—§æ–‡ä»¶
tasks.CleanOldFiles("/var/log/", 7) // 7å¤©
```

### æœåŠ¡ä»»åŠ¡ (ServiceTasks)
```go
tasks := library.NewServiceTasks()

// å®‰è£…äºŒè¿›åˆ¶ä¸ºç³»ç»ŸæœåŠ¡
tasks.InstallBinaryAsService("myapp", "/opt/myapp/bin", systemdTemplate)

// ç¡®ä¿æœåŠ¡è¿è¡Œ
tasks.EnsureServiceRunning("nginx")

// é‡è½½æœåŠ¡é…ç½®
tasks.ReloadServiceConfig("nginx")
```

### åŒ…ç®¡ç†ä»»åŠ¡ (PackageTasks)
```go
tasks := library.NewPackageTasks()

// å®‰è£…ä¾èµ–åŒ…
tasks.InstallDependencies([]string{"git", "build-essential", "curl"})

// ç¡®ä¿åŒ…ç‰ˆæœ¬
tasks.EnsurePackageVersion("docker-ce", "20.10.0")

// ä»URLå®‰è£…
tasks.InstallFromURL("https://example.com/package.deb")
```

### ç½‘ç»œä»»åŠ¡ (NetworkTasks)
```go
tasks := library.NewNetworkTasks()

// é…ç½®é˜²ç«å¢™
tasks.ConfigureFirewall([]int{80, 443}, "tcp")

// SSHåŠ å›º
tasks.HardenSSH()

// é…ç½®ä»£ç†
tasks.SetupProxy("http://proxy.company.com:8080")
```

## ğŸ“¦ å†…å®¹åˆ†å‘ (Content Distribution)

### åµŒå…¥å¼å†…å®¹
```go
//go:embed templates/*
var templatesFS embed.FS

content := library.NewEmbeddedContent(templatesFS, "templates")

// éƒ¨ç½²åµŒå…¥çš„æ–‡ä»¶
content.DeployFile("config.yml", "/etc/app/config.yml")

// éƒ¨ç½²æ•´ä¸ªç›®å½•
content.DeployDirectory("configs", "/etc/app/")
```

### å¤–éƒ¨æ–‡ä»¶åˆ†å‘
```go
dist := library.NewDistributionTasks()

// æ³¨å†Œæ–‡ä»¶
dist.RegisterFile("binary", "/local/app", 0755)

// åˆ†å‘åˆ°è¿œç¨‹
dist.DistributeBinary("binary", "/opt/app/bin/app", true)

// å¹¶è¡Œåˆ†å‘å¤šä¸ªæ–‡ä»¶
dist.ParallelDistribute([]string{"file1", "file2", "file3"}, 5)
```

## ğŸ­ Playbook åŠŸèƒ½

### æ¡ä»¶æ‰§è¡Œ
```yaml
- name: Install on Ubuntu
  package:
    name: nginx
  when: ansible_os_family == "Debian"
```

### å¾ªç¯æ“ä½œ
```yaml
- name: Create users
  user:
    name: "{{ item }}"
    state: present
  loop:
    - alice
    - bob
    - charlie
```

### å¤„ç†å™¨ (Handlers)
```yaml
handlers:
  - name: restart nginx
    service:
      name: nginx
      state: restarted
```

### æ ‡ç­¾ (Tags)
```yaml
- name: Install web server
  package:
    name: nginx
  tags:
    - web
    - nginx
```

## ğŸ” å®‰å…¨åŠŸèƒ½

### Ansible Vault åŠ å¯†
```go
vault := vault.New("password")

// åŠ å¯†æ•æ„Ÿæ•°æ®
encrypted := vault.Encrypt([]byte("secret"))

// è§£å¯†
decrypted := vault.Decrypt(encrypted)
```

## ğŸš€ å¹¶å‘æ‰§è¡Œ
```go
runner := runner.NewTaskRunner()

// è®¾ç½®å¹¶å‘æ•°
runner.SetMaxConcurrency(10)

// å¹¶è¡Œæ‰§è¡Œä»»åŠ¡
runner.ExecuteTasks(ctx, tasks, inventory)
```

## ğŸ“‹ æ¨¡å—å‚æ•°é€ŸæŸ¥è¡¨

### File æ¨¡å—
| å‚æ•° | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| path | æ–‡ä»¶è·¯å¾„ | `/tmp/test` |
| state | çŠ¶æ€ | `file`, `directory`, `link`, `absent`, `touch` |
| mode | æƒé™ | `0755` |
| owner | æ‰€æœ‰è€… | `root` |
| group | ç»„ | `root` |
| src | é“¾æ¥æº | `/opt/app` |
| recurse | é€’å½’ | `true` |
| force | å¼ºåˆ¶ | `true` |

### Service æ¨¡å—
| å‚æ•° | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| name | æœåŠ¡å | `nginx` |
| state | çŠ¶æ€ | `started`, `stopped`, `restarted`, `reloaded` |
| enabled | å¼€æœºå¯åŠ¨ | `true` |
| daemon_reload | é‡è½½daemon | `true` |

### Package æ¨¡å—
| å‚æ•° | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| name | åŒ…å | `nginx,vim,git` |
| state | çŠ¶æ€ | `present`, `absent`, `latest` |
| update_cache | æ›´æ–°ç¼“å­˜ | `true` |

### User æ¨¡å—
| å‚æ•° | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| name | ç”¨æˆ·å | `john` |
| state | çŠ¶æ€ | `present`, `absent` |
| uid | ç”¨æˆ·ID | `1001` |
| gid | ç»„ID | `1001` |
| groups | é™„åŠ ç»„ | `sudo,docker` |
| append | è¿½åŠ ç»„ | `true` |
| home | å®¶ç›®å½• | `/home/john` |
| shell | Shell | `/bin/bash` |
| password | å¯†ç  | `encrypted_pass` |
| system | ç³»ç»Ÿç”¨æˆ· | `true` |
| remove | åˆ é™¤å®¶ç›®å½• | `true` |

### Group æ¨¡å—
| å‚æ•° | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| name | ç»„å | `developers` |
| state | çŠ¶æ€ | `present`, `absent` |
| gid | ç»„ID | `2001` |
| system | ç³»ç»Ÿç»„ | `true` |

## ğŸ¯ å¸¸è§ä½¿ç”¨åœºæ™¯

### 1. æ‰¹é‡éƒ¨ç½²åº”ç”¨
```bash
# åˆ›å»ºåº”ç”¨ç›®å½•
gosinble -i inventory.yml -m file -a "path=/opt/myapp state=directory" -hosts all

# å¤åˆ¶åº”ç”¨æ–‡ä»¶
gosinble -i inventory.yml -m copy -a "src=myapp dest=/opt/myapp/myapp mode=0755" -hosts all

# åˆ›å»ºæœåŠ¡æ–‡ä»¶
gosinble -i inventory.yml -m template -a "src=myapp.service.j2 dest=/etc/systemd/system/myapp.service" -hosts all

# å¯åŠ¨æœåŠ¡
gosinble -i inventory.yml -m service -a "name=myapp state=started enabled=true daemon_reload=true" -hosts all
```

### 2. ç³»ç»Ÿåˆå§‹åŒ–
```bash
# æ›´æ–°åŒ…ç¼“å­˜
gosinble -i inventory.yml -m package -a "update_cache=true" -hosts all

# å®‰è£…åŸºç¡€åŒ…
gosinble -i inventory.yml -m package -a "name=vim,git,curl,wget,htop state=present" -hosts all

# åˆ›å»ºç®¡ç†ç”¨æˆ·
gosinble -i inventory.yml -m user -a "name=admin groups=sudo shell=/bin/bash" -hosts all

# é…ç½®SSH
gosinble -i inventory.yml -m file -a "path=/home/admin/.ssh state=directory mode=0700" -hosts all
```

### 3. å®‰å…¨åŠ å›º
```bash
# ç¦ç”¨root SSHç™»å½•
gosinble -i inventory.yml -m shell -a "cmd='sed -i s/PermitRootLogin yes/PermitRootLogin no/ /etc/ssh/sshd_config'" -hosts all

# é‡å¯SSHæœåŠ¡
gosinble -i inventory.yml -m service -a "name=ssh state=restarted" -hosts all

# é…ç½®é˜²ç«å¢™
gosinble -i inventory.yml -m shell -a "cmd='ufw allow 22/tcp && ufw allow 80/tcp && ufw allow 443/tcp && ufw --force enable'" -hosts all
```

---
*è¿™äº›å†…ç½®æ“ä½œè¦†ç›–äº†ç³»ç»Ÿç®¡ç†çš„ç»å¤§éƒ¨åˆ†åœºæ™¯ï¼Œä»åŸºç¡€çš„æ–‡ä»¶æ“ä½œåˆ°å¤æ‚çš„æœåŠ¡éƒ¨ç½²ï¼Œéƒ½å¯ä»¥è½»æ¾å¤„ç†ï¼*